#include "UtilityCommon.h"
#include "./StreamHashKey.h"

namespace util {
;

//////////////////////////////////////////////////////////////////////////
// reference Unreal3 GameEngine, Epic Games, co.ltd.
// - changes : 처음 사용한 SHA alogrithm hash는 유니크 할 수는 없었다.
//            희박한 확률이라도 Hash중복 가능성이 있었고, 또한 기타 여러
//            가지 면에서도 당근 아래와 같은 코드가 더 효율적이다.
// - (CHANGES) (f100813.3L) make to a constant table and add extended interfaces
//#define _SDL_CRC32_POLYNOMIAL  0x04C11DB7

HashKey StreamHashKey::GetStringHashKey(const char* input_str)
{
    const char* it = input_str;
    HashKey crc = 0xFFFFFFFF;
    //
    for ( ; *it != '\0'; ++it)
    {
        char    c   = *it;
        HashKey cL  = c & 255;
                crc = (crc << 8) ^ crc_table_static_[ (crc >> 24) ^ cL ];
    }

    return ~crc;
}

HashKey StreamHashKey::GetStringHashKey(const wchar_t* input_wstr)
{
    const wchar_t* it = input_wstr;
    const wchar_t* end = it + wcslen(input_wstr);
    HashKey crc = 0xFFFFFFFF;
    //
    for ( ; it != end; ++it)
    {
        wchar_t c   = *it;
        HashKey cL  = c & 255;
                crc = (crc << 8) ^ crc_table_static_[ (crc >> 24) ^ cL ];
        HashKey cH  = (c >> 8) & 255;
                crc = (crc << 8) ^ crc_table_static_[ (crc >> 24) ^ cH ];
    }

    return ~crc;
}

HashKey StreamHashKey::GetMemoryHashKey(const void* input_ptr, size_t length)
{
    const uint8_t* it = reinterpret_cast<const uint8_t*>(input_ptr);
    const uint8_t* end = it + length;
    HashKey crc = 0xFFFFFFFF;
    //
    for ( ; it != end; ++it) {
        crc = (crc << 8) ^ crc_table_static_[ (crc >> 24) ^ *it ];
    }
    return ~crc;
}

//HashKey GetMemoryHashKeyEnDecode(const void* input_ptr, size_t length, HashKey endecode);

const HashKey StreamHashKey::crc_table_static_[256] =
{
    0x00000000, //[0x00]
    0x04C11DB7, //[0x01]
    0x09823B6E, //[0x02]
    0x0D4326D9, //[0x03]
    0x130476DC, //[0x04]
    0x17C56B6B, //[0x05]
    0x1A864DB2, //[0x06]
    0x1E475005, //[0x07]
    0x2608EDB8, //[0x08]
    0x22C9F00F, //[0x09]
    0x2F8AD6D6, //[0x0A]
    0x2B4BCB61, //[0x0B]
    0x350C9B64, //[0x0C]
    0x31CD86D3, //[0x0D]
    0x3C8EA00A, //[0x0E]
    0x384FBDBD, //[0x0F]
    0x4C11DB70, //[0x10]
    0x48D0C6C7, //[0x11]
    0x4593E01E, //[0x12]
    0x4152FDA9, //[0x13]
    0x5F15ADAC, //[0x14]
    0x5BD4B01B, //[0x15]
    0x569796C2, //[0x16]
    0x52568B75, //[0x17]
    0x6A1936C8, //[0x18]
    0x6ED82B7F, //[0x19]
    0x639B0DA6, //[0x1A]
    0x675A1011, //[0x1B]
    0x791D4014, //[0x1C]
    0x7DDC5DA3, //[0x1D]
    0x709F7B7A, //[0x1E]
    0x745E66CD, //[0x1F]
    0x9823B6E0, //[0x20]
    0x9CE2AB57, //[0x21]
    0x91A18D8E, //[0x22]
    0x95609039, //[0x23]
    0x8B27C03C, //[0x24]
    0x8FE6DD8B, //[0x25]
    0x82A5FB52, //[0x26]
    0x8664E6E5, //[0x27]
    0xBE2B5B58, //[0x28]
    0xBAEA46EF, //[0x29]
    0xB7A96036, //[0x2A]
    0xB3687D81, //[0x2B]
    0xAD2F2D84, //[0x2C]
    0xA9EE3033, //[0x2D]
    0xA4AD16EA, //[0x2E]
    0xA06C0B5D, //[0x2F]
    0xD4326D90, //[0x30]
    0xD0F37027, //[0x31]
    0xDDB056FE, //[0x32]
    0xD9714B49, //[0x33]
    0xC7361B4C, //[0x34]
    0xC3F706FB, //[0x35]
    0xCEB42022, //[0x36]
    0xCA753D95, //[0x37]
    0xF23A8028, //[0x38]
    0xF6FB9D9F, //[0x39]
    0xFBB8BB46, //[0x3A]
    0xFF79A6F1, //[0x3B]
    0xE13EF6F4, //[0x3C]
    0xE5FFEB43, //[0x3D]
    0xE8BCCD9A, //[0x3E]
    0xEC7DD02D, //[0x3F]
    0x34867077, //[0x40]
    0x30476DC0, //[0x41]
    0x3D044B19, //[0x42]
    0x39C556AE, //[0x43]
    0x278206AB, //[0x44]
    0x23431B1C, //[0x45]
    0x2E003DC5, //[0x46]
    0x2AC12072, //[0x47]
    0x128E9DCF, //[0x48]
    0x164F8078, //[0x49]
    0x1B0CA6A1, //[0x4A]
    0x1FCDBB16, //[0x4B]
    0x018AEB13, //[0x4C]
    0x054BF6A4, //[0x4D]
    0x0808D07D, //[0x4E]
    0x0CC9CDCA, //[0x4F]
    0x7897AB07, //[0x50]
    0x7C56B6B0, //[0x51]
    0x71159069, //[0x52]
    0x75D48DDE, //[0x53]
    0x6B93DDDB, //[0x54]
    0x6F52C06C, //[0x55]
    0x6211E6B5, //[0x56]
    0x66D0FB02, //[0x57]
    0x5E9F46BF, //[0x58]
    0x5A5E5B08, //[0x59]
    0x571D7DD1, //[0x5A]
    0x53DC6066, //[0x5B]
    0x4D9B3063, //[0x5C]
    0x495A2DD4, //[0x5D]
    0x44190B0D, //[0x5E]
    0x40D816BA, //[0x5F]
    0xACA5C697, //[0x60]
    0xA864DB20, //[0x61]
    0xA527FDF9, //[0x62]
    0xA1E6E04E, //[0x63]
    0xBFA1B04B, //[0x64]
    0xBB60ADFC, //[0x65]
    0xB6238B25, //[0x66]
    0xB2E29692, //[0x67]
    0x8AAD2B2F, //[0x68]
    0x8E6C3698, //[0x69]
    0x832F1041, //[0x6A]
    0x87EE0DF6, //[0x6B]
    0x99A95DF3, //[0x6C]
    0x9D684044, //[0x6D]
    0x902B669D, //[0x6E]
    0x94EA7B2A, //[0x6F]
    0xE0B41DE7, //[0x70]
    0xE4750050, //[0x71]
    0xE9362689, //[0x72]
    0xEDF73B3E, //[0x73]
    0xF3B06B3B, //[0x74]
    0xF771768C, //[0x75]
    0xFA325055, //[0x76]
    0xFEF34DE2, //[0x77]
    0xC6BCF05F, //[0x78]
    0xC27DEDE8, //[0x79]
    0xCF3ECB31, //[0x7A]
    0xCBFFD686, //[0x7B]
    0xD5B88683, //[0x7C]
    0xD1799B34, //[0x7D]
    0xDC3ABDED, //[0x7E]
    0xD8FBA05A, //[0x7F]
    0x690CE0EE, //[0x80]
    0x6DCDFD59, //[0x81]
    0x608EDB80, //[0x82]
    0x644FC637, //[0x83]
    0x7A089632, //[0x84]
    0x7EC98B85, //[0x85]
    0x738AAD5C, //[0x86]
    0x774BB0EB, //[0x87]
    0x4F040D56, //[0x88]
    0x4BC510E1, //[0x89]
    0x46863638, //[0x8A]
    0x42472B8F, //[0x8B]
    0x5C007B8A, //[0x8C]
    0x58C1663D, //[0x8D]
    0x558240E4, //[0x8E]
    0x51435D53, //[0x8F]
    0x251D3B9E, //[0x90]
    0x21DC2629, //[0x91]
    0x2C9F00F0, //[0x92]
    0x285E1D47, //[0x93]
    0x36194D42, //[0x94]
    0x32D850F5, //[0x95]
    0x3F9B762C, //[0x96]
    0x3B5A6B9B, //[0x97]
    0x0315D626, //[0x98]
    0x07D4CB91, //[0x99]
    0x0A97ED48, //[0x9A]
    0x0E56F0FF, //[0x9B]
    0x1011A0FA, //[0x9C]
    0x14D0BD4D, //[0x9D]
    0x19939B94, //[0x9E]
    0x1D528623, //[0x9F]
    0xF12F560E, //[0xA0]
    0xF5EE4BB9, //[0xA1]
    0xF8AD6D60, //[0xA2]
    0xFC6C70D7, //[0xA3]
    0xE22B20D2, //[0xA4]
    0xE6EA3D65, //[0xA5]
    0xEBA91BBC, //[0xA6]
    0xEF68060B, //[0xA7]
    0xD727BBB6, //[0xA8]
    0xD3E6A601, //[0xA9]
    0xDEA580D8, //[0xAA]
    0xDA649D6F, //[0xAB]
    0xC423CD6A, //[0xAC]
    0xC0E2D0DD, //[0xAD]
    0xCDA1F604, //[0xAE]
    0xC960EBB3, //[0xAF]
    0xBD3E8D7E, //[0xB0]
    0xB9FF90C9, //[0xB1]
    0xB4BCB610, //[0xB2]
    0xB07DABA7, //[0xB3]
    0xAE3AFBA2, //[0xB4]
    0xAAFBE615, //[0xB5]
    0xA7B8C0CC, //[0xB6]
    0xA379DD7B, //[0xB7]
    0x9B3660C6, //[0xB8]
    0x9FF77D71, //[0xB9]
    0x92B45BA8, //[0xBA]
    0x9675461F, //[0xBB]
    0x8832161A, //[0xBC]
    0x8CF30BAD, //[0xBD]
    0x81B02D74, //[0xBE]
    0x857130C3, //[0xBF]
    0x5D8A9099, //[0xC0]
    0x594B8D2E, //[0xC1]
    0x5408ABF7, //[0xC2]
    0x50C9B640, //[0xC3]
    0x4E8EE645, //[0xC4]
    0x4A4FFBF2, //[0xC5]
    0x470CDD2B, //[0xC6]
    0x43CDC09C, //[0xC7]
    0x7B827D21, //[0xC8]
    0x7F436096, //[0xC9]
    0x7200464F, //[0xCA]
    0x76C15BF8, //[0xCB]
    0x68860BFD, //[0xCC]
    0x6C47164A, //[0xCD]
    0x61043093, //[0xCE]
    0x65C52D24, //[0xCF]
    0x119B4BE9, //[0xD0]
    0x155A565E, //[0xD1]
    0x18197087, //[0xD2]
    0x1CD86D30, //[0xD3]
    0x029F3D35, //[0xD4]
    0x065E2082, //[0xD5]
    0x0B1D065B, //[0xD6]
    0x0FDC1BEC, //[0xD7]
    0x3793A651, //[0xD8]
    0x3352BBE6, //[0xD9]
    0x3E119D3F, //[0xDA]
    0x3AD08088, //[0xDB]
    0x2497D08D, //[0xDC]
    0x2056CD3A, //[0xDD]
    0x2D15EBE3, //[0xDE]
    0x29D4F654, //[0xDF]
    0xC5A92679, //[0xE0]
    0xC1683BCE, //[0xE1]
    0xCC2B1D17, //[0xE2]
    0xC8EA00A0, //[0xE3]
    0xD6AD50A5, //[0xE4]
    0xD26C4D12, //[0xE5]
    0xDF2F6BCB, //[0xE6]
    0xDBEE767C, //[0xE7]
    0xE3A1CBC1, //[0xE8]
    0xE760D676, //[0xE9]
    0xEA23F0AF, //[0xEA]
    0xEEE2ED18, //[0xEB]
    0xF0A5BD1D, //[0xEC]
    0xF464A0AA, //[0xED]
    0xF9278673, //[0xEE]
    0xFDE69BC4, //[0xEF]
    0x89B8FD09, //[0xF0]
    0x8D79E0BE, //[0xF1]
    0x803AC667, //[0xF2]
    0x84FBDBD0, //[0xF3]
    0x9ABC8BD5, //[0xF4]
    0x9E7D9662, //[0xF5]
    0x933EB0BB, //[0xF6]
    0x97FFAD0C, //[0xF7]
    0xAFB010B1, //[0xF8]
    0xAB710D06, //[0xF9]
    0xA6322BDF, //[0xFA]
    0xA2F33668, //[0xFB]
    0xBCB4666D, //[0xFC]
    0xB8757BDA, //[0xFD]
    0xB5365D03, //[0xFE]
    0xB1F740B4, //[0xFF]
};

}; //end of namespace
